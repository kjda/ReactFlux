!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n(require("promise")):"function"==typeof define&&define.amd?define(["promise"],n):"object"==typeof exports?exports.ReactFlux=n(require("promise")):t.ReactFlux=n(t.promise)}(this,function(t){return function(t){function n(r){if(e[r])return e[r].exports;var o=e[r]={exports:{},id:r,loaded:!1};return t[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var e={};return n.m=t,n.c=e,n.p="",n(0)}([function(t,n,e){var r=e(28),o=e(31),i=e(45),s=e(1),a=e(56),c=e(30),u=new a;t.exports={configs:c,createActions:function(t){return new o(u,t)},createStore:function(t,n){return new i(u,t,n)},createConstants:function(t,n){return new r(t,n)},dispatch:function(t,n){u.dispatch(t,n)},dispatcher:u,mixinFor:s}},function(t,n,e){var r=e(2);t.exports=function(){var t=Array.prototype.slice.call(arguments);if(!t.length)throw new Error("Flux.mixinFor expects a store or a list of stores");return r(t,function(t){var n="undefined"==typeof t||"function"!=typeof t.onChange||"function"!=typeof t.offChange;if(n)throw new Error("Flux.mixinFor expects a store or an array of stores")}),{componentWillMount:function(){"undefined"==typeof this._react_flux_onChange&&(this._react_flux_onChange=function(){this.isMounted()&&this.setState(this.getStateFromStores())}.bind(this)),this.setState(this.getStateFromStores())},componentDidMount:function(){for(var n=0;n<t.length;n++)t[n].onChange(this._react_flux_onChange)},componentWillUnmount:function(){for(var n=0;n<t.length;n++)t[n].offChange(this._react_flux_onChange)}}}},function(t,n,e){var r=e(3),o=e(4),i=e(25),s=i(r,o);t.exports=s},function(t,n,e){function r(t,n){for(var e=-1,r=t.length;++e<r&&n(t[e],e,t)!==!1;);return t}t.exports=r},function(t,n,e){var r=e(5),o=e(24),i=o(r);t.exports=i},function(t,n,e){function r(t,n){return o(t,n,i)}var o=e(6),i=e(10);t.exports=r},function(t,n,e){var r=e(7),o=r();t.exports=o},function(t,n,e){function r(t){return function(n,e,r){for(var i=o(n),s=r(n),a=s.length,c=t?a:-1;t?c--:++c<a;){var u=s[c];if(e(i[u],u,i)===!1)break}return n}}var o=e(8);t.exports=r},function(t,n,e){function r(t){return o(t)?t:Object(t)}var o=e(9);t.exports=r},function(t,n,e){function r(t){var n=typeof t;return!!t&&("object"==n||"function"==n)}t.exports=r},function(t,n,e){var r=e(11),o=e(15),i=e(9),s=e(19),a=r(Object,"keys"),c=a?function(t){var n=null==t?void 0:t.constructor;return"function"==typeof n&&n.prototype===t||"function"!=typeof t&&o(t)?s(t):i(t)?a(t):[]}:s;t.exports=c},function(t,n,e){function r(t,n){var e=null==t?void 0:t[n];return o(e)?e:void 0}var o=e(12);t.exports=r},function(t,n,e){function r(t){return null==t?!1:o(t)?f.test(c.call(t)):i(t)&&s.test(t)}var o=e(13),i=e(14),s=/^\[object .+?Constructor\]$/,a=Object.prototype,c=Function.prototype.toString,u=a.hasOwnProperty,f=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=r},function(t,n,e){function r(t){return o(t)&&a.call(t)==i}var o=e(9),i="[object Function]",s=Object.prototype,a=s.toString;t.exports=r},function(t,n,e){function r(t){return!!t&&"object"==typeof t}t.exports=r},function(t,n,e){function r(t){return null!=t&&i(o(t))}var o=e(16),i=e(18);t.exports=r},function(t,n,e){var r=e(17),o=r("length");t.exports=o},function(t,n,e){function r(t){return function(n){return null==n?void 0:n[t]}}t.exports=r},function(t,n,e){function r(t){return"number"==typeof t&&t>-1&&t%1==0&&o>=t}var o=9007199254740991;t.exports=r},function(t,n,e){function r(t){for(var n=c(t),e=n.length,r=e&&t.length,u=!!r&&a(r)&&(i(t)||o(t)),p=-1,l=[];++p<e;){var h=n[p];(u&&s(h,r)||f.call(t,h))&&l.push(h)}return l}var o=e(20),i=e(21),s=e(22),a=e(18),c=e(23),u=Object.prototype,f=u.hasOwnProperty;t.exports=r},function(t,n,e){function r(t){return i(t)&&o(t)&&a.call(t,"callee")&&!c.call(t,"callee")}var o=e(15),i=e(14),s=Object.prototype,a=s.hasOwnProperty,c=s.propertyIsEnumerable;t.exports=r},function(t,n,e){var r=e(11),o=e(18),i=e(14),s="[object Array]",a=Object.prototype,c=a.toString,u=r(Array,"isArray"),f=u||function(t){return i(t)&&o(t.length)&&c.call(t)==s};t.exports=f},function(t,n,e){function r(t,n){return t="number"==typeof t||o.test(t)?+t:-1,n=null==n?i:n,t>-1&&t%1==0&&n>t}var o=/^\d+$/,i=9007199254740991;t.exports=r},function(t,n,e){function r(t){if(null==t)return[];c(t)||(t=Object(t));var n=t.length;n=n&&a(n)&&(i(t)||o(t))&&n||0;for(var e=t.constructor,r=-1,u="function"==typeof e&&e.prototype===t,p=Array(n),l=n>0;++r<n;)p[r]=r+"";for(var h in t)l&&s(h,n)||"constructor"==h&&(u||!f.call(t,h))||p.push(h);return p}var o=e(20),i=e(21),s=e(22),a=e(18),c=e(9),u=Object.prototype,f=u.hasOwnProperty;t.exports=r},function(t,n,e){function r(t,n){return function(e,r){var a=e?o(e):0;if(!i(a))return t(e,r);for(var c=n?a:-1,u=s(e);(n?c--:++c<a)&&r(u[c],c,u)!==!1;);return e}}var o=e(16),i=e(18),s=e(8);t.exports=r},function(t,n,e){function r(t,n){return function(e,r,s){return"function"==typeof r&&void 0===s&&i(e)?t(e,r):n(e,o(r,s,3))}}var o=e(26),i=e(21);t.exports=r},function(t,n,e){function r(t,n,e){if("function"!=typeof t)return o;if(void 0===n)return t;switch(e){case 1:return function(e){return t.call(n,e)};case 3:return function(e,r,o){return t.call(n,e,r,o)};case 4:return function(e,r,o,i){return t.call(n,e,r,o,i)};case 5:return function(e,r,o,i,s){return t.call(n,e,r,o,i,s)}}return function(){return t.apply(n,arguments)}}var o=e(27);t.exports=r},function(t,n,e){function r(t){return t}t.exports=r},function(t,n,e){var r=e(2),o=e(21),i=e(29),s=e(30).constants.get();t.exports=function(t,n){if(!o(t))throw new Error("createConstants expects first parameter to be an array of strings");if(n=n||"",!i(n))throw new Error("createConstants expects second parameter string");n.length>0&&(n+=s.separator);var e={};return r(t,function(t){if(!i(t))throw new Error("createConstants expects all constants to be strings");e[t]=n+t,e[t+"_"+s.successSuffix]=n+t+s.separator+s.successSuffix,e[t+"_"+s.failSuffix]=n+t+s.separator+s.failSuffix,e[t+"_"+s.afterSuffix]=n+t+s.separator+s.afterSuffix}),e}},function(t,n,e){function r(t){return"string"==typeof t||o(t)&&a.call(t)==i}var o=e(14),i="[object String]",s=Object.prototype,a=s.toString;t.exports=r},function(t,n,e){var r=e(29),o="_",i="SUCCESS",s="FAIL",a="AFTER",c={constants:{separator:o,successSuffix:i,failSuffix:s,afterSuffix:a}};t.exports={constants:{setSeparator:function(t){if(!r(t)||!t.length)throw new Error("Constants.separator must be a non empty string");c.constants.separator=t},setSuccessSuffix:function(t){if(!r(t)||!t.length)throw new Error("Constants.successSuffix must be a non empty string");c.constants.successSuffix=t},setFailSuffix:function(t){if(!r(t)||!t.length)throw new Error("Constants.failSuffix must be a non empty string");c.constants.failSuffix=t},setAfterSuffix:function(t){if(!r(t)||!t.length)throw new Error("Constants.afterSuffix must be a non empty string");c.constants.afterSuffix=t},resetToDefaults:function(){c.constants.separator=o,c.constants.successSuffix=i,c.constants.failSuffix=s,c.constants.afterSuffix=a},get:function(){return c.constants}}}},function(t,n,e){var r=e(32),o=e(2),i=e(21),s=s||e(44),a=e(30).constants.get(),c=function(t,n){this._dispatcher=t,this._registerActions(n)};c.prototype=r(c.prototype,{_registerActions:function(t){o(t,function(t,n){if(!i(t))throw new Error("ReactFlux.Actions: Action must be an array {login: [CONSTANT, callback]}");var e=t[0],r=t[1];if("undefined"==typeof r)r=function(){};else if("function"!=typeof r)throw new Error("ReactFlux.Actions: you did not provide a valid callback for action: "+n);this[n]=this._createAction(n,e,r)}.bind(this))},_createAction:function(t,n,e){return function(){this._dispatch(n,null,arguments);var t=null;try{if(t=e.apply(this,arguments),t&&"object"==typeof t&&"[object Error]"==Object.prototype.toString.call(t))throw t}catch(r){t=new s(function(t,n){n(r)})}s.resolve(t).then(function(t){this._dispatch(n,"successSuffix",t),this._dispatch(n,"afterSuffix",t)}.bind(this),function(t){this._dispatch(n,"failSuffix",t),this._dispatch(n,"afterSuffix",t)}.bind(this))["catch"](function(t){console.error(t.toString(),t.stack)})}.bind(this)},_dispatch:function(t,n,e){n&&(t+=a.separator+a[n]),this._dispatcher.dispatch(t,e)}}),t.exports=c},function(t,n,e){var r=e(33),o=e(41),i=o(r);t.exports=i},function(t,n,e){function r(t,n,e,l,h){if(!c(t))return t;var d=a(n)&&(s(n)||f(n)),v=d?void 0:p(n);return o(v||n,function(o,s){if(v&&(s=o,o=n[s]),u(o))l||(l=[]),h||(h=[]),i(t,n,s,r,e,l,h);else{var a=t[s],c=e?e(a,o,s,t,n):void 0,f=void 0===c;f&&(c=o),void 0===c&&(!d||s in t)||!f&&(c===c?c===a:a!==a)||(t[s]=c)}}),t}var o=e(3),i=e(34),s=e(21),a=e(15),c=e(9),u=e(14),f=e(38),p=e(10);t.exports=r},function(t,n,e){function r(t,n,e,r,p,l,h){for(var d=l.length,v=n[e];d--;)if(l[d]==v)return void(t[e]=h[d]);var g=t[e],y=p?p(g,v,e,t,n):void 0,b=void 0===y;b&&(y=v,a(v)&&(s(v)||u(v))?y=s(g)?g:a(g)?o(g):[]:c(v)||i(v)?y=i(g)?f(g):c(g)?g:{}:b=!1),l.push(v),h.push(y),b?t[e]=r(y,v,p,l,h):(y===y?y!==g:g===g)&&(t[e]=y)}var o=e(35),i=e(20),s=e(21),a=e(15),c=e(36),u=e(38),f=e(39);t.exports=r},function(t,n,e){function r(t,n){var e=-1,r=t.length;for(n||(n=Array(r));++e<r;)n[e]=t[e];return n}t.exports=r},function(t,n,e){function r(t){var n;if(!s(t)||f.call(t)!=a||i(t)||!u.call(t,"constructor")&&(n=t.constructor,"function"==typeof n&&!(n instanceof n)))return!1;var e;return o(t,function(t,n){e=n}),void 0===e||u.call(t,e)}var o=e(37),i=e(20),s=e(14),a="[object Object]",c=Object.prototype,u=c.hasOwnProperty,f=c.toString;t.exports=r},function(t,n,e){function r(t,n){return o(t,n,i)}var o=e(6),i=e(23);t.exports=r},function(t,n,e){function r(t){return i(t)&&o(t.length)&&!!F[D.call(t)]}var o=e(18),i=e(14),s="[object Arguments]",a="[object Array]",c="[object Boolean]",u="[object Date]",f="[object Error]",p="[object Function]",l="[object Map]",h="[object Number]",d="[object Object]",v="[object RegExp]",g="[object Set]",y="[object String]",b="[object WeakMap]",x="[object ArrayBuffer]",_="[object Float32Array]",S="[object Float64Array]",j="[object Int8Array]",w="[object Int16Array]",m="[object Int32Array]",A="[object Uint8Array]",E="[object Uint8ClampedArray]",C="[object Uint16Array]",I="[object Uint32Array]",F={};F[_]=F[S]=F[j]=F[w]=F[m]=F[A]=F[E]=F[C]=F[I]=!0,F[s]=F[a]=F[x]=F[c]=F[u]=F[f]=F[p]=F[l]=F[h]=F[d]=F[v]=F[g]=F[y]=F[b]=!1;var O=Object.prototype,D=O.toString;t.exports=r},function(t,n,e){function r(t){return o(t,i(t))}var o=e(40),i=e(23);t.exports=r},function(t,n,e){function r(t,n,e){e||(e={});for(var r=-1,o=n.length;++r<o;){var i=n[r];e[i]=t[i]}return e}t.exports=r},function(t,n,e){function r(t){return s(function(n,e){var r=-1,s=null==n?0:e.length,a=s>2?e[s-2]:void 0,c=s>2?e[2]:void 0,u=s>1?e[s-1]:void 0;for("function"==typeof a?(a=o(a,u,5),s-=2):(a="function"==typeof u?u:void 0,s-=a?1:0),c&&i(e[0],e[1],c)&&(a=3>s?void 0:a,s=1);++r<s;){var f=e[r];f&&t(n,f,a)}return n})}var o=e(26),i=e(42),s=e(43);t.exports=r},function(t,n,e){function r(t,n,e){if(!s(e))return!1;var r=typeof n;if("number"==r?o(e)&&i(n,e.length):"string"==r&&n in e){var a=e[n];return t===t?t===a:a!==a}return!1}var o=e(15),i=e(22),s=e(9);t.exports=r},function(t,n,e){function r(t,n){if("function"!=typeof t)throw new TypeError(o);return n=i(void 0===n?t.length-1:+n||0,0),function(){for(var e=arguments,r=-1,o=i(e.length-n,0),s=Array(o);++r<o;)s[r]=e[n+r];switch(n){case 0:return t.call(this,s);case 1:return t.call(this,e[0],s);case 2:return t.call(this,e[0],e[1],s)}var a=Array(n+1);for(r=-1;++r<n;)a[r]=e[r];return a[n]=s,t.apply(this,a)}}var o="Expected a function",i=Math.max;t.exports=r},function(n,e,r){n.exports=t},function(t,n,e){function r(t){var n=t;this.assign=function(t){n=o(n,t)},this.get=function(t){return n[t]},this.getClone=function(t){var e=n[t];return e instanceof Object&&null!==e?a(e):e},this.replaceState=function(t){n=t},this.getState=function(){return n},this.getStateClone=function(){return a(n)}}var o=e(53),i=e(2),s=e(21),a=e(46),c=e(1),u="change",f=e(55),p=function(t,n,e){this.state=new r({_action_states:{}}),this._events={},this._actionHandlers={},this._constantHandlers={},this._dispatcherIndexes={},this._dispatcher=t,this._getInitialStateCalls=[],this._storeDidMountCalls=[],this._storeMixin(n),this._setInitialState(),e&&this._setConstantHandlers(e),i(this._storeDidMountCalls,function(t){t()})};p.prototype={setState:function(t){this.state.assign(t),this._emit(u)},replaceState:function(t){this.state.replaceState(t),this._emit(u)},get:function(t){return this.state.get(t)},getClone:function(t){return this.state.getClone(t)},getState:function(){return this.state.getState()},getStateClone:function(){return this.state.getStateClone()},setActionState:function(t,n){var e=this.state.get("_action_states");e[t]=o(e[t]||{},n),this.setState({_action_states:e})},resetActionState:function(t){if("undefined"==typeof this._actionHandlers[t])throw new Error("Store.resetActionState constant handler for ["+t+"] is not defined");var n=this.state.get("_action_states");n[t]=this._actionHandlers[t].getInitialState(),this.setState({_action_states:n})},getActionState:function(t,n){if("undefined"==typeof this._actionHandlers[t])throw new Error("Store.getActionState constant handler for ["+t+"] is not defined");var e=this.state.get("_action_states");return"undefined"==typeof n?e[t]:e[t][n]},isStore:function(){return!0},onChange:function(t){this._on(u,t)},offChange:function(t){this._off(u,t)},_storeMixin:function(t){t&&t.mixins&&s(t.mixins)&&i(t.mixins,this._storeMixin.bind(this)),i(t,function(t,n){"mixins"!==n&&("function"==typeof t&&(t=t.bind(this)),"getInitialState"===n?this._getInitialStateCalls.push(t):"storeDidMount"===n?this._storeDidMountCalls.push(t):this[n]=t)}.bind(this))},addActionHandler:function(t,n){return this._actionHandlers[t]=new f(this,t,n),this},_setConstantHandlers:function(t){if(!s(t))throw new Error("store expects handler definitions to be an array");i(t,function(t){if(!s(t))throw new Error("store expects handler definition to be an array");var n,e,r;if(n=t[0],2===t.length?(r=null,e=t[1]):(r=t[1],e=t[2]),"string"!=typeof n)throw new Error("store expects all handler definitions to contain a constant as the first parameter");if("function"!=typeof e)throw new Error("store expects all handler definitions to contain a callback");if(r&&!s(r))throw new Error("store expects waitFor to be an array of stores");var o=null;r&&(o=r.map(function(t){if(!(t instanceof p))throw new Error("store expects waitFor to be an array of stores");return t._getHandlerIndex(n)})),this._constantHandlers[n]=e.bind(this);var i=this._dispatcher.register(n,this._constantHandlers[n],o);this._dispatcherIndexes[n]=i}.bind(this))},_getHandlerIndex:function(t){if("undefined"==typeof this._dispatcherIndexes[t])throw new Error("Can not get store handler for constant: "+t);return this._dispatcherIndexes[t]},_setInitialState:function(){this.setState(this.getInitialState())},getInitialState:function(){var t={};return i(this._getInitialStateCalls,function(n){o(t,n())}),t},mixinFor:function(){return c(this)},_on:function(t,n){return"undefined"==typeof this._events[t]&&(this._events[t]=[]),this._events[t].push(n),n},_off:function(t,n){if("undefined"!=typeof this._events[t])for(var e=0,r=this._events[t].length;r>e;e++)if(this._events[t][e]===n){this._events[t].splice(e,1);break}},_emit:function(t){if("undefined"!=typeof this._events[t]){var n=Array.prototype.slice.call(arguments,1);i(this._events[t],function(t){"function"==typeof t&&t.apply(null,n)})}}},t.exports=p},function(t,n,e){function r(t,n,e){return"function"==typeof n?o(t,!0,i(n,e,3)):o(t,!0)}var o=e(47),i=e(26);t.exports=r},function(t,n,e){function r(t,n,e,d,v,g,y){var x;if(e&&(x=v?e(t,d,v):e(t)),void 0!==x)return x;if(!l(t))return t;var _=p(t);if(_){if(x=c(t),!n)return o(t,x)}else{var j=B.call(t),w=j==b;if(j!=S&&j!=h&&(!w||v))return R[j]?u(t,j,n):v?t:{};if(x=f(w?{}:t),!n)return s(x,t)}g||(g=[]),y||(y=[]);for(var m=g.length;m--;)if(g[m]==t)return y[m];return g.push(t),y.push(x),(_?i:a)(t,function(o,i){x[i]=r(o,n,e,i,t,g,y)}),x}var o=e(35),i=e(3),s=e(48),a=e(5),c=e(49),u=e(50),f=e(52),p=e(21),l=e(9),h="[object Arguments]",d="[object Array]",v="[object Boolean]",g="[object Date]",y="[object Error]",b="[object Function]",x="[object Map]",_="[object Number]",S="[object Object]",j="[object RegExp]",w="[object Set]",m="[object String]",A="[object WeakMap]",E="[object ArrayBuffer]",C="[object Float32Array]",I="[object Float64Array]",F="[object Int8Array]",O="[object Int16Array]",D="[object Int32Array]",H="[object Uint8Array]",k="[object Uint8ClampedArray]",M="[object Uint16Array]",U="[object Uint32Array]",R={};R[h]=R[d]=R[E]=R[v]=R[g]=R[C]=R[I]=R[F]=R[O]=R[D]=R[_]=R[S]=R[j]=R[m]=R[H]=R[k]=R[M]=R[U]=!0,R[y]=R[b]=R[x]=R[w]=R[A]=!1;var P=Object.prototype,B=P.toString;t.exports=r},function(t,n,e){function r(t,n){return null==n?t:o(n,i(n),t)}var o=e(40),i=e(10);t.exports=r},function(t,n,e){function r(t){var n=t.length,e=new t.constructor(n);return n&&"string"==typeof t[0]&&i.call(t,"index")&&(e.index=t.index,e.input=t.input),e}var o=Object.prototype,i=o.hasOwnProperty;t.exports=r},function(t,n,e){function r(t,n,e){var r=t.constructor;switch(n){case f:return o(t);case i:case s:return new r(+t);case p:case l:case h:case d:case v:case g:case y:case b:case x:var S=t.buffer;return new r(e?o(S):S,t.byteOffset,t.length);case a:case u:return new r(t);case c:var j=new r(t.source,_.exec(t));j.lastIndex=t.lastIndex}return j}var o=e(51),i="[object Boolean]",s="[object Date]",a="[object Number]",c="[object RegExp]",u="[object String]",f="[object ArrayBuffer]",p="[object Float32Array]",l="[object Float64Array]",h="[object Int8Array]",d="[object Int16Array]",v="[object Int32Array]",g="[object Uint8Array]",y="[object Uint8ClampedArray]",b="[object Uint16Array]",x="[object Uint32Array]",_=/\w*$/;t.exports=r},function(t,n,e){(function(n){function e(t){var n=new r(t.byteLength),e=new o(n);return e.set(new o(t)),n}var r=n.ArrayBuffer,o=n.Uint8Array;t.exports=e}).call(n,function(){return this}())},function(t,n,e){function r(t){var n=t.constructor;return"function"==typeof n&&n instanceof n||(n=Object),new n}t.exports=r},function(t,n,e){var r=e(54),o=e(48),i=e(41),s=i(function(t,n,e){return e?r(t,n,e):o(t,n)});t.exports=s},function(t,n,e){function r(t,n,e){for(var r=-1,i=o(n),s=i.length;++r<s;){var a=i[r],c=t[a],u=e(c,n[a],a,t,n);(u===u?u===c:c!==c)&&(void 0!==c||a in t)||(t[a]=u)}return t}var o=e(10);t.exports=r},function(t,n,e){function r(t,n,e){if(!t||"function"!=typeof t.isStore||!t.isStore())throw new Error("StoreActionHandler expects first parameter to be a store");if(!o(n)||!n.length)throw new Error("StoreActionHandler expects second parameter to be a constant(string)");if("undefined"==typeof e.getInitialState&&(e.getInitialState=function(){return{}}),"function"!=typeof e.getInitialState)throw new Error("StoreActionHandler expects getInitialState to be a function");e=e||{},this.parent=t,this.constant=n,this.getInitialState=e.getInitialState,this.before=e.before||null,this.after=e.after||null,this.success=e.success||null,this.fail=e.fail||null,this.parent.setActionState(this.constant,this.getInitialState());for(var r=[],a=s.length,c=0;a>c;c++){var u=s[c];if(null!==this[u]){if("function"!=typeof this[u])throw new Error('StoreActionHandler expects "'+u+'" to be a function');var f=this.constant;"before"!==u&&(f+=i.separator+i[u+"Suffix"]),r.push([f,this[u].bind(this)])}}t._setConstantHandlers(r)}var o=e(29),i=e(30).constants.get(),s=["before","after","success","fail"];r.prototype={setState:function(t){this.parent.setActionState(this.constant,t)},getState:function(){return this.parent.getActionState(this.constant)}},t.exports=r},function(t,n,e){function r(){this._registry={}}var o=o||e(44),i=e(32),s=e(21),a=e(29),c=e(2);r.prototype=i(r.prototype,{register:function(t,n,e){if(!a(t)||!t.length)throw new Error("Dispatcher.register: constant must be a string");if(e=e||null,"function"!=typeof n)throw new Error("Dispatcher.register expects second parameter to be a callback");if(null!==e&&!s(e))throw new Error("Dispatcher.register expects third parameter to be null or an array");var r=this._getRegistry(t);return r.callbacks.push(n),r.waitFor.push(e),r.callbacks.length-1},dispatch:function(t,n){var e=this._getRegistry(t);e.dispatchQueue.push({constant:t,payload:n}),this._dispatch(e)},_dispatch:function(t){if(!t.isDispatching&&t.dispatchQueue.length){t.isDispatching=!0;var n=t.dispatchQueue.shift();this._createDispatchPromises(t),c(t.callbacks,function(e,r){var i=function(t,n,e){return function(){o.resolve(t.callbacks[n](e)).then(function(){t.resolves[n](e)},function(){t.rejects[n](new Error("Dispatch callback error"))})}}(t,r,n.payload),s=t.waitFor[r];if(s){var a=this._getPromisesByIndexes(t,s);o.all(a).then(i,i)}else i()}.bind(this)),o.all(t.promises).then(function(){this._onDispatchEnd(t)}.bind(this),function(){this._onDispatchEnd(t)})}},_getRegistry:function(t){return"undefined"==typeof this._registry[t]&&(this._registry[t]={callbacks:[],waitFor:[],promises:[],resolves:[],rejects:[],dispatchQueue:[],isDispatching:!1}),this._registry[t]},_getPromisesByIndexes:function(t,n){return n.map(function(n){return t.promises[n]})},_createDispatchPromises:function(t){t.promises=[],t.resolves=[],t.rejects=[],c(t.callbacks,function(n,e){t.promises[e]=new o(function(n,r){t.resolves[e]=n,t.rejects[e]=r})})},_onDispatchEnd:function(t){t.promises=[],t.resolves=[],t.rejects=[],t.isDispatching=!1,this._dispatch(t)}}),t.exports=r}])});